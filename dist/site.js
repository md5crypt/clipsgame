(()=>{"use strict";class e{constructor(e){this._components=[],this._attached=!1,this.refs={},this.props=e}attach(){for(let e=0;e<this._components.length;e+=1){const t=this._components[e];t._attached||t.attach()}this._attached=!0,this.onAttach()}detach(){this._components.forEach(e=>e.detach()),this._components=[],this._attached=!1,this.refs={},this.parent=null,this.root=null,this.onDetach()}render(){return null}onBeforeRender(){}onRender(){}onAttach(){}onDetach(){}ref(t){return n=>{n instanceof e&&(n.parent=this,this._components.push(n),this._attached&&n.attach()),t&&(this.refs[t]=n)}}build(){this.onBeforeRender();const e=this.render();if(!e)throw new Error("can not render component: render function returned null");return this.root=e,this.onRender(),e}bind(e){this.parent=e,e!=this?(e._components.push(this),e._attached&&this.attach()):this.attach()}create(t,n,r){n?n instanceof e&&(n=n.root):n=t.root,"number"==typeof r?r=r<n.childNodes.length?n.childNodes[Math.max(0,r)]:void 0:r instanceof e&&(r=r.root),n.insertBefore(this.build(),void 0===r?null:r),this.bind(t)}replace(t,n){n instanceof e?(n.root.replaceWith(this.build()),n.destroy()):n.replaceWith(this.build()),this.bind(t)}createOrphanized(e){e.appendChild(this.build()),this.bind(this)}destroy(){if(this.root&&this.root.remove(),this.parent){const e=this.parent._components.indexOf(this);e>=0&&this.parent._components.splice(e,1)}this.detach()}get attached(){return this._attached}get htmlRoot(){return this.root}get components(){return this._components}}function t(e,n){for(let r=0;r<e.length;r+=1){const i=e[r];Array.isArray(i)?t(i,n):i&&n.push(i)}}function n(e,n){if(Array.isArray(e)){const r=[];return t(e,r),r.join(n)}return e||""}function r(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n+=1){const i=e[n];Array.isArray(i)?r(i,t):i&&t.appendChild(i instanceof Node?i:document.createTextNode(i))}else e&&t.appendChild(e instanceof Node?e:document.createTextNode(e))}function i(t,i){if("text"==t){const e=document.createTextNode(n(i.children,""));return i.ref&&i.ref(e),e}if("string"==typeof t){let e,s=!1;t.startsWith("svg")?(e=document.createElementNS("http://www.w3.org/2000/svg",3==t.length?"svg":t.slice(4)),s=!0):e=document.createElement(t);for(const t in i){let o=i[t];if(void 0===o);else if("children"==t)r(o,e);else if(t.startsWith("on"))e.addEventListener(t.slice(2).toLowerCase(),o);else if("innerHTML"==t)e.innerHTML=o;else if("ref"==t)o(e);else if("class"==t)o=n(o," "),o&&e.setAttribute("class",o);else if("style"==t)Object.assign(e.style,o);else{const n=s?t:t.toLowerCase();!0===o?e.setAttribute(n,""):!1===o||null===o?e.removeAttribute(n):"string"==typeof o?e.setAttribute(n,o):e.setAttribute(n,o.toString())}}return e}if(t.prototype instanceof e){const e=new t(i),n=e.build();return i.ref&&i.ref(e),n}{const e=t(i);return i.ref&&i.ref(e),e}}function s(e){const t=document.createDocumentFragment();return r(e.children,t),t}let o=!1,a=e=>{document.body.innerHTML="",document.body.append(function(e){const t=(e.error.stack||"").replace(/^Error:[^\n]*\n/,"");return i("pre",{style:{margin:"0",padding:"20px",fontSize:"14px",color:"white",backgroundColor:"black",whiteSpace:"pre-wrap",fontFamily:"monospace"},children:e.error.toString()+"\n"+t})}({error:e}))};function l(e,t){const n=[];if(!e)return t;for(let r=0;r<e.length;r+=1)for(let i=0;i<t.length;i+=1)n.push(e[r]+t[i]);return n}window.addEventListener("error",e=>{const t=e.error;t instanceof Error?(console.error(t),o||(a(t),o=!0)):console.error(e.message)}),window.addEventListener("unhandledrejection",e=>{const t=e.reason;console.error(t),t instanceof Error&&(o||(a(t),o=!0))});const c=new class{constructor(e){this._idGen=e.idGen,this._prefixedKeys=new Set(e.prefixedKeys),this._defaultUnits=new Map,this._shared=new Map,this._sharedSheetName=e.sharedSheetName,this._buffer=[];for(const t in e.defaultUnits)e.defaultUnits[t].forEach(e=>this._defaultUnits.set(e,t))}processFontFace(e){return(Array.isArray(e)?e:[e]).map(e=>"@font-face"+this.processRule("normal",e)).join("")}processValue(e,t){return"string"==typeof t?t:"number"==typeof t?t+(this._defaultUnits.get(e)||""):Array.isArray(t)?t.map(t=>this.processValue(e,t)).join(" "):t.toString()}processRule(e,t,n){const r=[],i=[];for(const s in t){const o=t[s];if("&"==s[0])r.push(this.processRule("normal",o,l(n,s.slice(1).replace(/\$/g,".$").split(/,/g))));else if(n&&"&"==s[s.length-1])r.push(this.processRule("normal",o,l(s.slice(0,-1).replace(/\$/g,".$").split(/,/g),n)));else if("@"==s[0])switch(s.match(/^@[^\s]*/)[0]){case"@keyframes":r.push(s+"{"+this.processRule("object",o)+"}");break;case"@media":r.push(s+"{"+this.processRule(n?"object-resolve":"object",o,n)+"}");break;case"@font-face":r.push(this.processFontFace(o));break;default:r.push(s+" "+o+";")}else if("normal"!=e)r.push(this.processRule("normal",o,l(n,["object-resolve"==e?".$"+s:s])));else if("composes"!=s){const e=s.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase()),t=this.processValue(e,o);i.push(e+":"+t+";"),this._prefixedKeys.has(e)&&(i.push("-ms-"+e+":"+t+";"),i.push("-moz-"+e+":"+t+";"),i.push("-webkit-"+e+":"+t+";"))}}return i.length?(n?n.join(", "):"")+"{"+i.join("")+"}"+r.join(""):r.join("")}compile(e,t){const n=[],r=new Map,i=new Map(this._shared);for(const s in e){const o=e[s],a=s.match(/^(@[^\s]+)(?:\s+([^\s].*))?/);if(a)switch(a[1]){case"@keyframes":{const e=this._idGen("keyframes-"+a[2],t);i.set(a[2],e),n.push("@keyframes "+e+"{"+this.processRule("object",o)+"}");break}case"@media":n.push(s+"{"+this.processRule("object-resolve",o)+"}");break;case"@font-face":n.push(this.processFontFace(o));break;case"@global":n.push(this.processRule("object",o));break;default:n.push(s+" "+o+";")}else{let e;if("$"==s[0]){const t=s.slice(1);e=this._shared.get(t),e||(e=this._idGen(t,this._sharedSheetName),this._shared.set(t,e),i.set(t,e))}else e=this._idGen(s,t),i.set(s,e);r.set(s,o.composes?e+" "+o.composes:e),n.push(this.processRule("normal",o,["."+e]))}}const s=n.join("").replace(/\$([A-Za-z0-9_-]+)/g,(e,t)=>i.get(t)||t),o={};return r.forEach((e,t)=>o[t]=e.replace(/\$([A-Za-z0-9_-]+)/g,(e,t)=>i.get(t)||t)),{classes:o,source:s}}inject(e,t,n){const{classes:r,source:i}=this.compile(t,n),s=document.createTextNode(i);if(e)e.appendChild(s);else{const e=document.createElement("style");e.appendChild(s),document.head.appendChild(e)}return r}buffer(e,t){const{classes:n,source:r}=this.compile(e,t);return this._buffer.push(r),n}flush(){const e=document.createElement("style");e.appendChild(document.createTextNode(this._buffer.join(""))),document.head.appendChild(e)}}({idGen:class{constructor(){this._map=new Map}static create(){return(new this).generator}get generator(){return(e,t)=>this.get(e,t)}reset(){this._map.clear()}get(e,t){const n=t?t+"-"+e:e,r=this._map.get(n);return this._map.set(n,r?r+1:1),n+(r||"")}}.create(),defaultUnits:{px:["background-position","background-position-x","background-position-y","background-size","border","border-bottom","border-bottom-left-radius","border-bottom-right-radius","border-bottom-width","border-left","border-left-width","border-radius","border-right","border-right-width","border-top","border-top-left-radius","border-top-right-radius","border-top-width","border-width","border-block","border-block-end","border-block-end-width","border-block-start","border-block-start-width","border-block-width","border-inline","border-inline-end","border-inline-end-width","border-inline-start","border-inline-start-width","border-inline-width","border-start-start-radius","border-start-end-radius","border-end-start-radius","border-end-end-radius","margin","margin-bottom","margin-left","margin-right","margin-top","margin-block","margin-block-end","margin-block-start","margin-inline","margin-inline-end","margin-inline-start","padding","padding-bottom","padding-left","padding-right","padding-top","padding-block","padding-block-end","padding-block-start","padding-inline","padding-inline-end","padding-inline-start","mask-position-x","mask-position-y","mask-size","height","width","min-height","max-height","min-width","max-width","bottom","left","top","right","inset","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","box-shadow","text-shadow","column-gap","column-rule","column-rule-width","column-width","font-size","font-size-delta","letter-spacing","text-decoration-thickness","text-indent","text-stroke","text-stroke-width","word-spacing","motion","motion-offset","outline","outline-offset","outline-width","perspective","vertical-align","flex-basis","shape-margin","size","gap","grid","grid-gap","row-gap","grid-row-gap","grid-column-gap","grid-template-rows","grid-template-columns","grid-auto-rows","grid-auto-columns","box-shadow-x","box-shadow-y","box-shadow-blur","box-shadow-spread","font-line-height","text-shadow-x","text-shadow-y","text-shadow-blur"],ms:["animation-delay","animation-duration","transition-delay","transition-duration"],"%":["perspective-origin-x","perspective-origin-y","transform-origin","transform-origin-x","transform-origin-y","transform-origin-z"]},prefixedKeys:["user-select","tab-size"]});c.buffer({$smallScreen:{}});const d=function(e,t){return c.buffer(e,t)};class h extends Error{}class u{constructor(){this._sequence=0,this._routes=[]}static createUri(e){return window.location.pathname+window.location.search+(e?"#"+e:"")}static parseUri(e){return(void 0===e?window.location:new URL(e)).hash.slice(1)}resolvePath(e){let t;const n=this._routes.find(n=>(t=e.match(n.pattern),t));if(!n)throw new Error(`route for path \`${e}\` not found`);return n.onNavigate(t)}register(e){this._routes.push(e)}async navigate(e,t="push"){var n,r;const i=this._sequence+1;this._sequence=i,null===(n=this.onNavigationStart)||void 0===n||n.call(this);let s=null;for(;!s;){"push"==t?window.history.pushState(null,"",u.createUri(e)):"replace"==t&&window.history.replaceState(null,"",u.createUri(e));try{const n=await this.resolvePath(e);"string"==typeof n?(e=n,t="replace"):s=n}catch(e){if(e instanceof Error&&this.onNavigationError)return void this.onNavigationError(e);throw e}}this._sequence==i?null===(r=this.onNavigationEnd)||void 0===r||r.call(this,s):s.destroy()}}const p=new u,f={"*":5,"**":4,"***":6,_:5,__:4,"~~":7};function g(e,t={}){const n=/!\[([^\[\]]*)\]\(([^()]+)\)|\<(https?:\/\/[^<>]*[^\s])\>|\]\(([^)]*)\)|(\*{1,3}|_{1,2}|~~|`{1,}|\[|\\.)|([\t ]*)\r?\n/g,r={type:-1};let i=r,s=[],o=0,a=0;function l(e){if(e){let t=e,n=e.next;for(;n;)0==t.type&&0==n.type?(t.value+=n.value,n=n.next,t.next=n):(t=n,n=n.next)}return e}function c(t){if(t<0||t>=e.length)return 2;{const n=e.charCodeAt(t);return n<=32||160==n?2:n>=33&&n<=47||n>=58&&n<=64||n>=91&&n<=96||n>=123&&n<=126?1:0}}function d(e){i.next=e,i=e}function h(e,t){const n={type:0,value:e};d(n),t&&s.push(n)}function u(){for(n.lastIndex=o,1==a?h(" "):2==a&&d({type:1});;){const t=n.exec(e);if(!t)return o<e.length&&(h(e.slice(o)),o=e.length),!1;if(t.index!=o&&h(e.slice(o,t.index)),void 0!==t[1])d({type:15,src:t[2],alt:t[1]});else if(void 0!==t[3]){const e=t[3];d({type:14,href:e,tree:{type:0,value:e}})}else if(void 0!==t[4]){const e=s.length;let n=e-1;for(;n>=0&&"["!=s[n].value;n-=1);if(n<0)h(t[0]);else{const r=s[n];for(r.type=14,r.tree=l(r.next),r.next=void 0,r.href=t[4],i=r;n<e;n+=1)s.pop()}}else if(void 0!==t[5]){const r=t[5];if("`"==r[0]){let t=e.indexOf(r,n.lastIndex);t<0?h(r):(d({type:9,value:e.slice(n.lastIndex,t)}),n.lastIndex=t+r.length)}else if("\\"==r[0])h(r[1]);else if("["==r)h(r,!0);else{const e=c(t.index-1),o=c(n.lastIndex);let a=-1;if(2!=e&&("_"!=r[0]||0!=o))for(a=s.length-1;a>=0&&s[a].value!=r;a-=1);if(a<0)h(r,2!=o&&("_"!=r[0]||0!=e));else{const e=s[a];e.type=f[r],e.tree=l(e.next),e.next=void 0,i=e;const t=s.length;for(;a<t;a+=1)s.pop()}}}else if(void 0!==t[6])return a=t[6].length>=2?2:1,o=n.lastIndex,!0;o=n.lastIndex}}if(t.inline){for(;u(););l(r.next)}else!function(){const n=/```([^\s]*)[ \t]*\r?\n|(#+)[ \t]+|(-{3,}|\*{3,})[ \t]*(?:\r?\n|$)|([ \t]*)(\d+\.|[*+-])[ \t]+|(>[\t ]*)|[^\S\r\n]*\r?\n/y,c=[],h=e.length,p=t.stream;let f=!1;function g(){for(f=!1;s.length;)s.pop();a=0}function m(){const e=c.pop();e.tree=l(e.next),e.next=void 0,i=e}function b(e){w(),d(e)}function v(e,t){t||w(),d(e),c.push(e)}function w(){for(g();c.length;)m();p&&r.next&&(p(r.next),r.next=void 0,i=r)}for(;o<h;){n.lastIndex=o;const t=n.exec(e);if(t){if(o=n.lastIndex,void 0!==t[1]){let n=e.indexOf("\n```",o-1);n<0&&(n=h),b({type:10,value:e.slice(o,n),lang:t[1]}),o=n+4;continue}if(void 0!==t[2]){v({type:11,level:t[2].length}),u(),m();continue}if(void 0!==t[3]){b({type:2});continue}if(void 0!==t[4]){const e=t[4].length;let n=c.length-1,r=!0;if(n>=0&&13==c[n].type){let t=c[n-1]._i;if(e<t+2){for(m(),n-=1;e<t-1&&n>0;)m(),m(),n-=2,t=c[n]._i;v({type:13},!0),r=!1}g()}else w();if(r){const n=t[5],r={type:12,_i:e};n.length>1&&(r.start=parseInt(n)),v(r,!0),v({type:13},!0)}}else{if(void 0===t[6]){f=!0;continue}{const e=c.length-2;(f||e<0||8!=c[e].type)&&(v({type:8}),v({type:3},!0))}}}f&&w(),0==c.length&&v({type:3}),u()}w()}();return r.next}const m=d({keyword:{color:"#930f80"},name:{color:"#795da3"},operator:{color:"#0080c0"},variable:{color:"#ed6a43"},comment:{color:"#34a834"}},"ClipsCode");function b(e){const t=e.code,n=/(;[^\r\n]*)|(\?[^\s()&|~]*)|\b(defrule|deffacts|assert|retract|not|and|or|forall|exists)\b|((?:[&|~=><()-]+))|([^\s()]+)/g,r=document.createDocumentFragment();let s="",o=0;for(;;){const e=n.exec(t);if(!e){o<t.length&&r.append(t.slice(o));break}let a="";void 0!==e[1]?a=m.comment:void 0!==e[2]?a=m.variable:void 0!==e[3]?a=m.keyword:void 0!==e[4]?a=m.operator:void 0!==e[5]&&s==m.keyword&&(a=m.name),a&&(o!=e.index&&r.append(t.slice(o,e.index)),r.appendChild(i("span",{class:a,children:e[0]})),o=n.lastIndex,s=a)}return r}const v=d({list:{marginBottom:16,marginTop:0,paddingLeft:"2em","&:last-child":{marginBottom:0},"& $list":{marginBottom:0},"& $list ol":{listStyleType:"lower-roman"},"& $list $list ol":{listStyleType:"lower-alpha"},"& li + li":{marginTop:4}},link:{color:"#4fa1db",textDecoration:"none","&:hover":{textDecoration:"underline"}},header:{lineHeight:1.25,paddingTop:".25em",margin:0,marginBottom:16,fontWeight:400,"&:first-child":{paddingTop:0},"h1&":{fontWeight:360,fontSize:"2.6em",paddingBottom:".2em",borderBottom:[1,"solid","#c9c9c9c9"],"$smallScreen &":{fontSize:"2.4em"}},"h2&":{fontWeight:340,fontSize:"2.15em",paddingBottom:".2em",borderBottom:[1,"solid","#c9c9c9c9"]},"h3&":{fontSize:"1.5em"},"h4&":{fontSize:"1.2em"},"h5&":{fontSize:16},"h6&":{fontSize:".85em",color:"#6a737d"}},code:{fontFamily:"SourceCodePro, monospace",padding:[0,".25em"],paddingTop:".175em",paddingBottom:".175em",margin:0,fontSize:".882em",backgroundColor:"#80808014",borderRadius:3,fontWeight:450},block:{margin:0,marginBottom:16,fontFamily:"SourceCodePro, monospace",wordWrap:"normal",overflow:"auto",padding:16,borderRadius:3,backgroundColor:"#1b1f2305",tabSize:4,paddingBottom:16,fontSize:14,lineHeight:1.8,fontWeight:450,"&:last-child":{marginBottom:0}},blockquote:{margin:0,marginBottom:16,padding:16,color:"#6a737d",borderLeft:[10,"solid","#80808013"],backgroundColor:"#1b1f2305","&:last-child":{marginBottom:0}},line:{height:"0.25em",margin:[24,0],border:0,borderBottom:[1,"solid","#eee"],backgroundColor:"#e1e4e880"},paragraph:{margin:0,marginBottom:16,textAlign:"justify","&:last-child":{marginBottom:0}},bold:{fontWeight:600}},"typography");function w(e){return i(`h${e.level}`,{class:v.header,children:e.text||e.children})}function x(e){return i("pre",{class:v.block,children:e.text||e.children})}function y(e){return i("code",{class:v.code,children:e.text||e.children})}function _(e){return i("strong",{class:v.bold,children:e.text||e.children})}function k(e){return i("p",{class:v.paragraph,children:e.text||e.children})}function S(e){return i("blockquote",{class:v.blockquote,children:e.text||e.children})}function C(e){return i("hr",{class:v.line})}function A(e){return i("a",{class:v.link,href:e.href,children:e.text||e.children})}function $(e){const t=e.items?e.items.map(e=>i("li",{children:e})):e.children;return void 0===e.start?i("ul",{class:v.list,children:t}):i("ol",{start:e.start,class:v.list,children:t})}function E(e,t){for(;e;)L(e,t),e=e.next}function L(e,t){function n(n){t.appendChild(n),E(e.tree,n)}switch(e.type){case 0:n(i("text",{children:e.value}));break;case 1:n(i("br",{}));break;case 2:n(i(C,{}));break;case 3:n(i(k,{}));break;case 4:n(i(_,{}));break;case 5:n(i("em",{}));break;case 6:t.appendChild(i("em",{children:i("strong",{ref:t=>E(e.tree,t)})}));break;case 7:n(i("del",{}));break;case 8:n(i(S,{}));break;case 9:n(i(y,{text:e.value}));break;case 10:n(i(x,{children:"clips"==e.lang?i(b,{code:e.value}):e.value}));break;case 11:n(i(w,{level:e.level}));break;case 12:n(i($,{start:e.start}));break;case 13:n(i("li",{}));break;case 14:n(i(A,{href:e.href}));break;case 15:n(i("img",{alt:e.alt,src:e.src}))}}function T(e){const t=document.createDocumentFragment();return e.inline?E(g(e.content,{inline:!0}),t):g(e.content,{stream:e=>L(e,t)}),t}const I=d({root:{padding:15,position:"relative",border:[1,"solid","transparent"],borderRadius:4,boxSizing:"border-box",width:"100%",lineHeight:"normal","& > a":{color:"currentColor",fontWeight:600}},withButton:{paddingRight:35},success:{color:"#3c763d",backgroundColor:"#dff0d8",borderColor:"#d6e9c6"},danger:{color:"#a94442",backgroundColor:"#f2dede",borderColor:"#ebccd1"},info:{color:"#31708f",backgroundColor:"#d9edf7",borderColor:"#bce8f1"},warning:{color:"#8a6d3b",backgroundColor:"#fcf8e3",borderColor:"#faebcc"},header:{fontWeight:"bold"},button:{position:"absolute",top:16,right:14,width:20,fill:"currentColor",cursor:"pointer",opacity:.2,"&:hover":{color:"#000",opacity:.5}}},"Alert");class R extends e{render(){const e=this.props;return i("div",{class:[I.root,I[e.type],e.closable&&I.withButton,e.class],children:[e.content&&i(T,{inline:!0,content:e.content}),e.children,e.closable&&i("svg",{class:I.button,viewBox:"0 0 24 24",onClick:()=>this.destroy(),children:i("svg:path",{d:"M20 6.91L17.09 4L12 9.09L6.91 4L4 6.91L9.09 12L4 17.09L6.91 20L12 14.91L17.09 20L20 17.09L14.91 12L20 6.91Z"})})]})}}class B{constructor(){this._cache=new Map,this._inProgress=new Map}static loadFromUrl(e){return new Promise((t,n)=>{const r=new XMLHttpRequest;r.responseType="arraybuffer",r.onload=()=>{r.status>=200&&r.status<300?t(r.response):n(new Error(r.statusText))},r.onerror=()=>n(new Error(r.statusText)),r.open("GET",e),r.send(null)})}async get(e){let t=this._cache.get(e);if(!t){let n=this._inProgress.get(e);if(n)return n;n=B.loadFromUrl(e),this._inProgress.set(e,n),t=await n,this._inProgress.delete(e),this._cache.set(e,t)}return t}getString(e){return this.get(e).then(e=>new TextDecoder("utf8").decode(e))}getJson(e){return this.getString(e).then(e=>JSON.parse(e))}}const z=new B,U=d({root:{color:"#000",opacity:.4,fontSize:16,verticalAlign:"middle",display:"inline-block","$smallScreen &":{marginRight:8,"& svg":{marginLeft:-6}},"& svg":{width:"1em",fill:"currentColor",marginLeft:-28},"&:hover":{opacity:.75}}},"BackButton");function F(e){return i("a",{class:[U.root,e.class],href:"#"+(e.path||""),onClick:t=>{t.preventDefault(),p.navigate(e.path||"")},children:i("svg",{viewBox:"0 0 14 14",children:i("svg:path",{d:"M5,3V0L1,4l4,4V5c0,0,6,0,6,3s-5,4-5,4v2c0,0,7-1,7-6C13,4,8,3,5,3z"})})})}class M extends e{static async onNavigate(){return new M({content:await z.getString("howtoplay.md")})}render(){return i("div",{children:i(T,{content:this.props.content})})}onRender(){const e=this.root.firstChild;e&&e.insertBefore(i(F,{}),e.firstChild)}}M.pattern=/^how-to-play$/,p.register(M);const N=["tiger","bow","life","wife","traveler","tea","athena"];p.register({pattern:/^level-(\d+)$/,onNavigate:async e=>{const t=parseInt(e[1])-1;if(t>=0&&t<N.length)return"level-"+N[t];throw new h(`**No such level!** Level \`${e[0]}\` does not exist. Go back to [level select](#home).`)}});class O{static create(e){return async function(e={}){var t,n,r,i,s=e,o=!1;function a(){var e=n.buffer;s.HEAP8=new Int8Array(e),new Int16Array(e),r=new Uint8Array(e),new Uint16Array(e),new Int32Array(e),i=new Uint32Array(e),new Float32Array(e),new Float64Array(e)}var l=new TextDecoder,c={varargs:void 0,getStr(e){var t=(e=>{if(!e)return"";var t=((e,t)=>{for(var n=t+void 0;e[t]&&!(t>=n);)++t;return t})(r,e);return l.decode(r.subarray(e,t))})(e);return t}},d=0,h=(e,t)=>t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN,u=(e,t)=>Math.ceil(e/t)*t,p=e=>{var t=(e-n.buffer.byteLength+65535)/65536|0;try{return n.grow(t),a(),1}catch(e){}},f=e=>{throw`exit(${e})`},g=f,m={},b=[],v={};m=new Uint8Array(0),v=new TextEncoder("utf8");var w={a:{b:function(e,t,n){return c.varargs=n,0},g:function(e,t,n){return c.varargs=n,0},h:function(e,t,n,r){return d=0,0},o:()=>function(){throw""}(),n:()=>{},l:()=>{throw 1/0},i:function(e,t,n){h(e,t)},j:function(e,t,n){h(e,t)},d:function(e,t,n,r){},p:()=>Date.now(),c:e=>{var t=r.length,n=2147483648;if((e>>>=0)>n)return!1;for(var i=1;i<=4;i*=2){var s=t*(1+.2/i);s=Math.min(s,e+100663296);var o=Math.min(n,u(Math.max(e,s),65536));if(p(o))return!0}return!1},q:g,a:function(e){return 0},f:function(e,t,n,s){const o=m;let a=d,l=o.length-a,c=0;for(let e=0;e<n&&l>0;e+=1){const n=t+8*e>>2,s=i[n+0],d=Math.min(l,i[n+1]);r.set(o.subarray(a,a+d),s),a+=d,c+=d,l-=d}return d=a,i[s>>2]=c,0},k:function(e,t,n,r,s){var o=h(t,n);return 1==r?o+=d:2==r&&(o+=m.length),o=Math.max(0,Math.min(o)),d=o,i[0+(s>>2)]=o,i[1+(s>>2)]=0,0},e:function(e,t,n,s){let o=0;for(let e=0;e<n;e+=1)o+=i[t+4+8*e>>2];const a=new Uint8Array(o);let l=0;for(let e=0;e<n;e+=1){const n=t+8*e>>2,s=i[n+0],o=i[n+1];a.set(r.subarray(s,s+o),l),l+=o}return b.push(a),i[s>>2]=o,0},m:f}};return s.noExitRuntime&&s.noExitRuntime,s.UTF8Decoder=l,s.UTF8Encoder=v,s.setInput=function(e){m=v.encode(e),d=0},s.flushOutput=function(){const e=new Uint8Array(b.reduce((e,t)=>e+t.length,0));let t=0;for(const n of b)e.set(n,t),t+=n.length;return b=[],l.decode(e)},WebAssembly.instantiate(s.wasm,w).then(e=>{var r=e.instance.exports;!function(e){s._SetEvaluationError=e.s,s._SetHaltExecution=e.t,s._RouteCommand=e.u,s._CreateEnvironment=e.v,s._DestroyEnvironment=e.w,s._free=e.x,s._malloc=e.y,e.dynCall_jiji}(r),n=r.r,a(),o=!0,t?.(s)}),o?s:new Promise((e,n)=>{t=e})}({wasm:e}).then(e=>new this(e))}constructor(e){this._module=e,this._commandBuffer=this._module._malloc(1024),this._env=this._module._CreateEnvironment()}destroy(){this._module._free(this._commandBuffer),this._module._DestroyEnvironment(this._env)}setFile(e){this._module.setInput(e)}flush(){return this._module.flushOutput()}command(e){const t=this._module.UTF8Encoder.encode(e);if(t.length>1023)throw new Error("input too long");return this._module.HEAP8.set(t,this._commandBuffer),this._module.HEAP8[this._commandBuffer+t.length]=0,this._module._SetEvaluationError(this._env,!1),this._module._SetHaltExecution(this._env,!1),this._module._RouteCommand(this._env,this._commandBuffer,!1)}}class j extends Error{}class D extends Error{}class P extends Error{}class W extends Error{}class H{static parseTabuRule(e){const t=e.replace(/([()])/g,"\\$1").replace(/\?/g,"[^\\s()]+").replace(/((?:[\w-]+\s*\|\s*)+[\w-]+)/g,"(?:$1)");return new RegExp("^"+t+"$")}constructor(e,t,n,r){var i;this.onOutput=e=>{},this.name=t,this.definition=n,this.clips=e,this.script=r,this._tabu=(null===(i=n.tabu)||void 0===i?void 0:i.map(H.parseTabuRule))||[],this._facts=new Set,this._assertions=[],this._limit=void 0===n.limit||-1==n.limit?1/0:n.limit,this._factsString=""}eval(...e){const t=[];for(const n of e){if(t.push(`CLIPS> ${n}\n`),!this.clips.command(n))throw t.push(this.clips.flush()),this.onOutput(t.join("")),new j(n);t.push(this.clips.flush())}this.onOutput(t.join(""))}run(e){this.eval(`(assert ${e})`,"(run)")}readFacts(){this.clips.command("(facts)");const e=this.clips.flush();this._factsString=e;const t=this._facts;t.clear();const n=/[(][^)]+[)]/g;for(;;){const r=n.exec(e);if(!r)break;t.add(r[0])}}assert(e){if(this._tabu.find(t=>t.test(e)))throw new P(e);if(this._facts.has(e))throw new D(e);if(this._assertions.length>=this._limit)throw new W(e);this._assertions.push(e),this.run(e),this.readFacts()}undo(){const e=this._assertions.pop();return this.reset(!1),e}reset(e=!0){if(this.clips.setFile(this.script),this.clips.flush(),this.eval("(clear)","(watch compilations)","(watch facts)","(watch activations)","(watch rules)",`(load ${this.name}.clp)`),this.clips.flush(),this.eval("(reset)","(run)"),e)this._assertions=[];else for(const e of this._assertions)this.run(e);this.readFacts()}get canUndo(){return this._assertions.length>0}get remainingAssertions(){return this._limit-this._assertions.length}get goalAchieved(){const e=this.definition.goal;return Array.isArray(e)?e.every(e=>this._facts.has(e)):this._facts.has(e)}get facts(){return this._factsString}get assertions(){return this._assertions}}const G=d({root:{position:"relative",width:40,height:24,transition:"background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",backgroundColor:"#e5e5e5",borderRadius:24,boxShadow:"0px 3px 4px -2px #00000014","& > div":{position:"absolute",width:20,height:20,borderRadius:20,top:2,left:2,background:"#fff",transition:"left 0.2s"}},toggled:{backgroundColor:"#999","& > div":{left:18}}},"Toggle");class q extends e{constructor(){super(...arguments),this._value=!1}render(){return i("div",{class:G.root,onClick:()=>this.handleClick(),children:i("div",{})})}onRender(){this.props.toggled&&(this.value=!0)}handleClick(){this._value=!this._value,this.root.classList.toggle(G.toggled,this._value),this.props.onToggle&&this.props.onToggle(this._value)}get value(){return this._value}set value(e){this._value=e,this.root.classList.toggle(G.toggled,e)}}class V extends Error{}function J(e){const t=/([a-zA-Z_][\w-]*)|([\w-]+)|([()])|(\n|$)|;[^\n]*|[^\S\n]+|(.)/g,n=[],r=[];let i,s=0,o=[];function a(t){const n=e.indexOf("\n",s),r=e.slice(s,n<0?void 0:n);throw new V(`Failed to parse \`${r}\`, ${t}.`)}function l(e){return"("+e.map(e=>Array.isArray(e)?l(e):e).join(" ")+")"}do{if(i=t.exec(e),!i)throw new Error("this should not happen");if(void 0!==i[1])o.push(i[1]);else if(i[2])0==o.length&&a(`a fact has to start from a word, got \`${i[0]}\``),o.push(i[2]);else if(void 0!==i[3])if("("==i[0])r.push(o),o=[];else{0==r.length&&a("unmatched `)`"),0==o.length&&a("empty parenthesis group");const e=o;o=r.pop(),o.push(e)}else if(void 0!==i[4]){if(0!=r.length&&a("unclosed `(`"),o.length>0){1==o.length&&Array.isArray(o[0])&&(o=o[0]),2==o.length&&"assert"==o[0]&&Array.isArray(o[1])&&(o=o[1]),0==o.length&&a("empty input");const e=o.find(e=>Array.isArray(e));e&&a(`unexpected nested group \`${l(e)}\``),n.push(l(o)),o=[]}s=t.lastIndex}else void 0!==i[5]&&a(`unexpected character: \`${i[0]}\``)}while(i.index<e.length);return n}const K=d({input:{color:"#888"},fact:{color:"#795da3"},activation:{color:"#930f80"},fire:{color:"#0080c0"},remove:{textDecoration:"line-through"},name:{fontWeight:640}},"ClipsOutput");function Z(e){const t=e.input;if(0==t.length)return null;const n=/(?:(CLIPS)>|(==>|<==)\s*f-\d+|(==>|<==)\s*Activation\s*\d+|(FIRE)\s*\d+)\s*/gy,r=document.createDocumentFragment();let s=0;for(;s<t.length;){n.lastIndex=s;const e=n.exec(t);let o=t.indexOf("\n",e?n.lastIndex:s);if(o<0?o=t.length:o+=1,e)if(void 0!==e[1])r.appendChild(i("span",{class:K.input,children:t.slice(s,o)}));else if(void 0!==e[2])r.appendChild(i("span",{class:[K.fact,"<"==e[0][0]&&K.remove],children:[t.slice(s,n.lastIndex),i("span",{class:K.name,children:t.slice(n.lastIndex,o)})]}));else{let a=t.indexOf(":",n.lastIndex);a<0&&(a=e.index),r.appendChild(i("span",{class:void 0!==e[4]?K.fire:[K.activation,"<"==e[0][0]&&K.remove],children:[t.slice(s,n.lastIndex),e.index<a&&i("span",{class:K.name,children:t.slice(n.lastIndex,a)}),t.slice(a,o)]}))}else r.append(t.slice(s,o));s=o}return r}const X=d({root:{display:"flex",flexDirection:"column"},input:{width:"100%",padding:[0,8],margin:0,fontFamily:"SourceCodePro, monospace",fontSize:14,fontWeight:450,boxSizing:"border-box",border:[1,"solid","#ccc"],height:36,color:"inherit",borderRadius:4,"&:focus":{outline:"none"}},textarea:{height:"auto",resize:"none",overflowX:"auto",overflowY:"hidden",whiteSpace:"pre",padding:8,margin:0,lineHeight:"inherit"},hint:{fontSize:12,color:"#777",marginTop:6,marginLeft:3,textAlign:"justify","$smallScreen &":{marginLeft:0}},buttons:{display:"flex",flexDirection:"row",marginTop:16,"$smallScreen &":{flexDirection:"row-reverse"}},scriptToggle:{float:"right",display:"flex",alignItems:"center",flexDirection:"column",marginTop:2,userSelect:"none","& > span":{color:"#777",fontSize:12,fontWeight:380,marginTop:5}},spacer:{flexGrow:1,"$smallScreen &":{display:"none"}},button:{"&:first-child":{marginLeft:0},"$smallScreen &":{flexGrow:1,"&:last-child":{marginLeft:0},"&:first-child":{marginLeft:10}},position:"relative",borderRadius:4,padding:[18,0],lineHeight:0,backgroundColor:"#999",color:"#f6f6f6",cursor:"pointer",textAlign:"center",fontWeight:500,width:100,boxSizing:"border-box",marginLeft:10,boxShadow:"inset 0px -2px 2px 0px #0000002e, inset 0px 2px 6px -1px #ffffff6e, 0px 2px 4px #00000024",userSelect:"none"},badge:{position:"absolute",bottom:-18,width:"100%",fontSize:12,color:"#777",fontWeight:380,lineHeight:1},alert:{marginBottom:16},disabled:{boxShadow:"none",background:"#ccc",pointerEvents:"none"},lineMode:{"& $scriptOnly":{display:"none"}},scriptMode:{"& $lineOnly":{display:"none"}},scriptOnly:{},lineOnly:{}},"LevelPage");class Y extends e{constructor(){super(...arguments),this._populateTextarea=!1}static async onNavigate(e){const t=e[1],n=await z.getJson("levels/index.json");if(!n.includes(t))throw new h(`**No such level!** Level \`${t}\` does not exist. Go back to [level select](#home).`);let r,i,s;return await Promise.all([this.getClips().then(e=>s=e),z.getJson(`levels/${t}.json`).then(e=>r=e),z.getString(`levels/${t}.clp`).then(e=>i=e)]),new Y({level:new H(s,t,r,i),index:n})}static async getClips(){return this._clips||(this._clips=await z.get("clips/clips.wasm").then(e=>O.create(e))),this._clips}render(){const e=this.props.level,t=e.definition,n=localStorage.getItem("scriptMode");return i("div",{class:[X.root,n?X.scriptMode:X.lineMode],children:[i(w,{level:1,children:[i(F,{}),`Level ${this.props.index.indexOf(e.name)+1}: ${t.title}`]}),i(k,{children:i(T,{content:t.description,inline:!0})}),i(w,{level:4,text:"Goal"}),i(k,{children:i(T,{content:t.goalDescription,inline:!0})}),t.tabu&&t.tabu.length>0&&i(s,{children:[i(w,{level:4,text:"Restricted facts"}),i($,{items:t.tabu.map(e=>i(y,{text:e}))})]}),i(w,{level:2,text:"Definitions"}),i(x,{children:i(b,{code:e.script})}),i(w,{level:2,text:"Output"}),i(w,{level:4,text:"Fact Table"}),i(x,{children:i("text",{ref:this.ref("factTable")})}),i(w,{level:4,text:"Console"}),i(x,{ref:this.ref("console")}),i(w,{level:2,children:[i("span",{children:"Input"}),i("div",{class:X.scriptToggle,children:[i(q,{toggled:null!=n,onToggle:e=>this.handleModeToggle(e)}),i("span",{children:"Script mode"})]})]}),i("input",{ref:this.ref("lineInput"),class:[X.input,X.lineOnly],placeholder:"(fact to be asserted)",onKeyDown:e=>"Enter"==e.key&&this.handleAssert()}),i("textarea",{ref:this.ref("scriptInput"),class:[X.input,X.textarea,X.scriptOnly],placeholder:"(fact to be asserted)",spellcheck:"false",onInput:()=>this.handleScriptInputUpdate(),rows:4}),i("div",{class:X.hint,children:[i("span",{class:X.lineOnly,children:["A single fact to be asserted, parenthesis around the fact are optional eg. ",i(y,{children:"(dog is bark)"})," and ",i(y,{children:"dog is bark"})," are both valid."]}),i("span",{class:X.scriptOnly,children:["One fact per line, parenthesis are optional, comments are allowed with ",i(y,{children:";"}),". Pressing ",i(y,{children:"RUN"})," resets the level and asserts all listed facts one by one."]})]}),i("div",{class:X.buttons,children:[i("div",{ref:this.ref("assertButton"),onClick:()=>this.handleAssert(),class:[X.button,X.lineOnly],children:["ASSERT",isFinite(e.remainingAssertions)&&i("div",{class:X.badge,children:[i("text",{ref:this.ref("counter")})," remaining"]})]}),i("div",{ref:this.ref("undoButton"),onClick:()=>this.handleUndo(),class:[X.button,X.lineOnly],children:"UNDO"}),i("div",{class:X.spacer}),i("div",{ref:this.ref("resetButton"),onClick:()=>this.handleReset(),class:[X.button,X.lineOnly],children:"RESET"}),i("div",{onClick:()=>this.handleRun(),class:[X.button,X.scriptOnly],children:"RUN"})]})]})}onAttach(){const e=this.props.level;e.onOutput=e=>this.refs.console.appendChild(i(Z,{input:e})),e.reset(),this.update()}clearConsole(){const e=this.refs.console;for(;e.lastChild;)e.lastChild.remove()}clearAlert(){this._alert&&(this._alert.destroy(),this._alert=void 0)}alert(e,t){this.clearAlert(),this._alert=new R({closable:!0,content:e,type:t,class:X.alert}),this._alert.create(this,null,this.refs.lineInput)}update(){const e=this.props.level;this.refs.factTable.nodeValue=e.facts||"empty",this.refs.undoButton.classList.toggle(X.disabled,!e.canUndo),this.refs.resetButton.classList.toggle(X.disabled,!e.canUndo);const t=e.remainingAssertions;if(isFinite(t)&&(this.refs.counter.nodeValue=t.toString(),this.refs.assertButton.classList.toggle(X.disabled,0==t)),e.goalAchieved){const t=this.props.index,n=t.indexOf(e.name)+1,r=n<t.length?` Click [here](#level-${t[n]}) to continue to the next level.`:"";return this.alert(`**Level cleared!** ${e.definition.winMessage}${r}`,"success"),!0}return 0==t&&(this.alert("**Level failed!** No more facts can be asserted and the goal has not been reached.","warning"),!0)}displayError(e){if(e instanceof j)this.alert(`**Evaluation Error!** The input \`${e.message}\` has incorrect syntax.`,"danger");else if(e instanceof V)this.alert(`**Incorrect Input!** ${e.message}`,"danger");else if(e instanceof D)this.alert(`**Fact reassertion!** The fact \`${e.message}\` is already in the fact table.`,"warning");else if(e instanceof P)this.alert(`**Restricted fact!** The fact \`${e.message}\` is restricted in this level and can not be asserted.`,"warning");else{if(!(e instanceof W))throw e;this.alert(`**Assertion limit reached!** The fact \`${e.message}\` could not be asserted due to reaching level's assertion limit.`,"warning")}}handleAssert(){const e=this.refs.lineInput.value;if(e){try{const t=J(e);if(0==e.length)return;if(1!=t.length)throw new V("only single fact allowed, for multiple fact input use script mode");this.props.level.assert(t[0]),this.refs.lineInput.value="",this.update()||this.alert(`**Fact asserted!** The fact \`${t[0]}\` has been added to the fact table.`,"info"),this._populateTextarea=!0}catch(e){this.displayError(e)}window.scrollTo(0,document.body.scrollHeight)}}handleRun(){const e=this.refs.scriptInput.value;if(e){try{this.clearConsole();const t=this.props.level;t.reset(),J(e).forEach(e=>t.assert(e)),this.update()||this.alert("**Level unsolved!** Provided facts did not solve the level, try again.","warning")}catch(e){this.update(),this.displayError(e)}window.scrollTo(0,document.body.scrollHeight)}}handleUndo(){this.clearConsole();const e=this.props.level.undo();this.refs.lineInput.value=e,this.update()||this.alert(`**Undo complete!** State before assertion of \`${e}\` has been restored.`,"info"),this._populateTextarea=!0,window.scrollTo(0,document.body.scrollHeight)}handleReset(){this.clearConsole(),this.refs.lineInput.value="",this.props.level.reset(),this.update(),this.alert("**Reset complete!** Level has been reset to it's initial state.","info"),window.scrollTo(0,document.body.scrollHeight)}handleModeToggle(e){if(this.root.classList.toggle(X.lineMode,!e),this.root.classList.toggle(X.scriptMode,e),e){const e=this.props.level.assertions;this._populateTextarea&&e.length&&(this.refs.scriptInput.value=e.join("\n"),this.handleScriptInputUpdate()),this._populateTextarea=!1,localStorage.setItem("scriptMode","1")}else localStorage.removeItem("scriptMode")}handleScriptInputUpdate(){const e=this.refs.scriptInput,t=e.value;let n=1;for(let e=0;e<t.length;e+=1)"\n"==t[e]&&(n+=1);e.rows=Math.max(4,n)}}Y.pattern=/^level-(.+)$/,p.register(Y);const Q=d({menuLink:{display:"flex",flexDirection:"row",fontSize:24,alignContent:"center",marginBottom:2,"& svg":{width:14,opacity:.4,marginRight:20}}},"IndexPage");function ee(e){return i("div",{class:Q.menuLink,children:[i("svg",{viewBox:"0 0 14 14",children:i("svg:path",{d:"M3.404 2.051 8.354 7l-4.95 4.95 2.121 2.12L12.596 7 5.525-.071z"})}),i(A,{href:e.href,children:e.children})]})}class te extends e{static async onNavigate(){return new te({index:await z.getJson("levels/index.json")})}render(){return i("div",{children:[i(w,{level:1,text:"Clips the Game"}),i(k,{children:["A demanding logic game based on the ",i(A,{text:"clips rule engine",href:"http://www.clipsrules.net/"}),"."]}),i(w,{level:2,text:"Level Select"}),i(ee,{href:"#how-to-play",children:"How to Play"}),this.props.index.map((e,t)=>i(ee,{href:`#level-${e}`,children:[i(_,{text:`Level ${t+1}`}),": ",i("em",{children:`${e}.clp`})]}))]})}}te.pattern=/.*/,p.register(te);const ne=d({"@global":{body:{margin:0,padding:0,backgroundColor:"#f6f6f6"}},root:{boxSizing:"border-box",width:"100%",padding:45,fontFamily:"SourceSans3, sans-serif",fontWeight:380,fontSize:17,lineHeight:1.45,display:"flex",flexDirection:"column",alignItems:"center",color:"#3f3f3f","& > *":{minWidth:200,maxWidth:900,width:"100%"},"&$smallScreen":{padding:24}},$smallScreen:{}},"RootComponent");c.flush(),(new class extends e{constructor(){super(...arguments),this._page=null,this._alert=null}clearAlert(){this._alert&&(this._alert.destroy(),this._alert=null)}alert(e,t=!1){this.clearAlert(),this.root.appendChild(i(R,{ref:e=>this._alert=e,content:e,type:t?"danger":"info"}))}render(){return i("div",{class:ne.root})}onAttach(){const e=window.matchMedia("(width <= 600px)");this.root.classList.toggle(ne.$smallScreen,e.matches),e.addEventListener("change",e=>{this.root.classList.toggle(ne.$smallScreen,e.matches)}),a=e=>{var t;null===(t=this._page)||void 0===t||t.destroy(),this.alert(`**Unexpected error**: ${e.message}`,!0)},p.onNavigationStart=()=>{var e;null===(e=this._page)||void 0===e||e.destroy(),this.alert("**Loading...** please wait while the game loads.")},p.onNavigationEnd=e=>{this.clearAlert(),this._page=e,e.create(this)},p.onNavigationError=e=>{if(!(e instanceof h))throw e;this.alert(e.message,!0)},this.start()}async start(){await Promise.all(["SourceCodePro","SourceSans3"].map(e=>{const t=new FontFace(e,`url(fonts/${e}.woff2)`,{weight:"200 900",display:"swap",style:"normal"}),n=t.load();return document.fonts.add(t),n.catch(()=>console.warn(`failed to load font ${e}`))})),p.navigate(u.parseUri(),"none"),window.addEventListener("popstate",()=>p.navigate(u.parseUri(),"replace"))}}).createOrphanized(document.body)})();